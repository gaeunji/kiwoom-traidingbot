# 키움증권 주식 매매 시스템 테스트 가이드

## 📋 테스트 파일 목록

### 1. **test_token.py** - 토큰 발급 테스트

- 접근 토큰 발급 테스트
- 토큰 유효성 확인 테스트
- Authorization 헤더 생성 테스트
- 토큰 갱신 및 초기화 테스트

### 2. **test_connection.py** - API 연결 테스트

- 기본 연결 및 인증 테스트
- 계좌 정보 조회 테스트
- 주식 현재가 조회 테스트
- 시장 데이터 API 테스트

### 3. **test_strategy.py** - 거래 전략 테스트

- 거래 전략 기능 테스트
- 종목 랭킹 테스트
- 캐시 관리 테스트

### 4. **test_order.py** - 주문 처리 테스트

- 주문 처리 기능 테스트
- 주문 유효성 검사 테스트

### 5. **test_order_new.py** - 새로운 주문 API 테스트

- 새로운 kt10000/kt10001 API 테스트
- 매수/매도 주문 파라미터 테스트
- 토큰 기반 인증 테스트

### 6. **run_all_tests.py** - 통합 테스트

- 모든 테스트를 순차적으로 실행

## 🚀 테스트 실행 방법

### 1. 환경 설정

#### A. .env 파일 생성

```bash
# env.example을 복사하여 .env 파일 생성
cp env.example .env
```

#### B. .env 파일 편집

```bash
# 실제 키움증권 API 정보 입력
KIWOOM_APP_KEY=your_actual_app_key
KIWOOM_APP_SECRET=your_actual_app_secret
ACCOUNT_NUMBER=your_actual_account_number
```

### 2. 의존성 설치

```bash
pip install -r requirements.txt
```

### 3. 개별 테스트 실행

#### A. 토큰 발급 테스트

```bash
python test_token.py
```

#### B. API 연결 테스트

```bash
python test_connection.py
```

**예상 결과:**

```
🚀 키움증권 API 연결 테스트 시작
✅ 환경 변수 설정 확인 완료

==================================================
테스트: 기본 연결
==================================================
=== 기본 연결 테스트 시작 ===
1. KiwoomConnector 테스트
✅ KiwoomConnector 연결 성공
✅ 액세스 토큰 유효

==================================================
테스트: API 클라이언트
==================================================
=== API 클라이언트 테스트 시작 ===
✅ API 클라이언트 연결 성공
1. 계좌 정보 조회 (기존 방식)
✅ 계좌 정보 조회 성공
2. 계좌평가잔고내역 조회 (새로운 방식)
✅ 계좌평가잔고내역 조회 성공
3. 주식 현재가 조회
✅ 005930 현재가: 70,000원
✅ 000660 현재가: 120,000원
✅ 035420 현재가: 200,000원

==================================================
테스트: 시장 데이터
==================================================
=== 시장 데이터 API 테스트 시작 ===
✅ 시장 데이터 API 연결 성공
1. 거래량 상위 종목 조회 (전체)
✅ 거래량 상위 종목 조회 성공: 5개
  1. 삼성전자 (005930)
     현재가: 70,000원, 거래량: 15,000,000
     등락률: +2.50%

테스트 결과 요약
==================================================
기본 연결: ✅ 성공
API 클라이언트: ✅ 성공
시장 데이터: ✅ 성공

전체 테스트: 3개 중 3개 성공
🎉 모든 테스트가 성공했습니다!
```

#### C. 거래 전략 테스트

```bash
python test_strategy.py
```

#### D. 주문 처리 테스트

```bash
python test_order.py
```

#### E. 새로운 주문 API 테스트

```bash
python test_order_new.py
```

### 4. 통합 테스트 실행

```bash
python run_all_tests.py
```

## 🔍 테스트 결과 해석

### ✅ 성공 케이스

- 모든 API 연결 성공
- 데이터 조회 정상
- 캐시 기능 정상
- 에러 처리 정상

### ❌ 실패 케이스

#### A. 환경 변수 오류

```
❌ 필수 환경 변수가 설정되지 않았습니다: KIWOOM_APP_KEY, KIWOOM_APP_SECRET
📝 .env 파일을 생성하고 필요한 정보를 입력해주세요.
```

**해결 방법:** `.env` 파일에 실제 API 키와 계좌번호 입력

#### B. API 연결 실패

```
❌ KiwoomConnector 연결 실패
```

**해결 방법:**

- API 키와 시크릿 확인
- 네트워크 연결 확인
- 키움증권 API 서비스 상태 확인

#### C. 계좌 정보 조회 실패

```
⚠️ 계좌 정보 조회 실패
```

**해결 방법:**

- 계좌번호 확인
- API 권한 확인
- 계좌 상태 확인

#### D. 시장 데이터 조회 실패

```
⚠️ 거래량 상위 종목 조회 실패
```

**해결 방법:**

- 장 시간 확인 (장 시간에만 실시간 데이터 제공)
- API 호출 제한 확인
- 네트워크 연결 확인

## ⚠️ 주의사항

### 1. **실제 거래 주의**

- 테스트 스크립트는 실제 주문을 하지 않습니다
- 실제 주문을 원할 경우 `test_order.py`의 주석을 해제하세요
- 실제 거래는 위험하므로 충분한 테스트 후 사용하세요

### 2. **API 호출 제한**

- 키움증권 API는 호출 제한이 있습니다
- 과도한 API 호출을 피하세요
- 캐시 기능을 활용하여 효율적으로 사용하세요

### 3. **장 시간 고려**

- 실시간 데이터는 장 시간에만 제공됩니다
- 장 외 시간에는 과거 데이터만 조회 가능합니다

### 4. **로그 확인**

- 테스트 실패 시 `trading.log` 파일을 확인하세요
- 상세한 에러 정보를 확인할 수 있습니다

## 🛠️ 문제 해결

### 1. **모듈 Import 오류**

```bash
ModuleNotFoundError: No module named 'kiwoom'
```

**해결 방법:** 프로젝트 루트 디렉토리에서 실행하세요

### 2. **의존성 오류**

```bash
ImportError: No module named 'loguru'
```

**해결 방법:** `pip install -r requirements.txt` 실행

### 3. **권한 오류**

```bash
PermissionError: [Errno 13] Permission denied
```

**해결 방법:** 관리자 권한으로 실행하거나 파일 권한 확인

### 4. **타임아웃 오류**

```bash
❌ 테스트 타임아웃 (5분 초과)
```

**해결 방법:** 네트워크 연결 확인 또는 API 서버 상태 확인

## 📞 지원

테스트 중 문제가 발생하면:

1. 로그 파일 확인 (`trading.log`)
2. 환경 변수 설정 확인
3. 네트워크 연결 확인
4. 키움증권 API 서비스 상태 확인

모든 테스트가 성공하면 시스템이 정상적으로 작동하는 것입니다! 🎉
